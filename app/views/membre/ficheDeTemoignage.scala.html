@*********************************************************************************
 * 
 *   Copyright 2014 BOUSSEJRA Malik Olivier, HALDEBIQUE Geoffroy, ROYER Johan
 *
 *   Licensed under the Apache License, Version 2.0 (the "License");
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 *   
 ********************************************************************************@
@main("Fiche de Témoignage"){
<header>
		<dl>
		<a href="/">Retour</a>
		</dl>
		<h1>Poster des témoignages </h1>
</header>
<script src="@routes.Assets.at("javascripts/jquery-1.11.0.min.js")" type="text/javascript"></script>
<link rel="stylesheet" href="@routes.Assets.at("stylesheets/jquery-ui-1.10.4.custom.min.css")">
<script type="text/javascript" src="/assets/javascripts/jquery-ui-1.10.4.custom.min.js"></script>
		<h1>Fiche de Témoignage </h1>
		<form action="/deposerTemoignage" method="POST">
			<table>
			<tr>
				<td>Commune :</td>
				<td>@listeDesCommunes("commune")</td>
			</tr>
			<tr>
			   <td>Lieu-dit :</td>
			   <td><input type="text" name="lieu-dit" placeholder="Lieu-dit ou indication de lieu"></td>
			</tr>
			<tr>
				<td>Coordonnées UTM :</td>
				<td>
				<select name="utm">
				@for(utm <- UTMS.findAll()){
					<option value="@utm">@utm</option>
				}
				</select>
				</td>
			</tr>
			<tr>
				<td>Date :</td>
				<td>
				@defining(Calendar.getInstance().getTime()){ maintenant =>
					<select name="jour">
					@for(i: Int <- 1 to 31){
						<option value="@i" @if(i==Integer.parseInt(maintenant.format("d"))){selected}>@i</option>
					}
					</select>
					<select name="mois">
					@for(i: Int <- 1 to 12){
						<option value="@i" @if(i==Integer.parseInt(maintenant.format("M"))){selected}>@i</option>
					}
					</select>
					<select name="annee">
					@for(i: Int <- 1950 to Integer.parseInt(Calendar.getInstance().getTime().format("yyyy"))){
						<option value="@i" @if(i==Integer.parseInt(maintenant.format("yyyy"))){selected}>@i</option>
					}
					</select>
				}
				</td>
			</tr>
			<tr>
				<td>Commentaires :</td>
				<td><input name="memo" type="text"></td>
			</tr>
			</table>
			<p>Espèces observées: </p>
			<div id="observation1"></div>
			<button id="apresDerniereObservation" onClick="ajouterObservation();return false;">Ajouter une observation</button>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button>Valider témoignage</button>
		</form>
}{
<script>
var nombreObservations=1;
$('#observation1').load('/deposerObservation/1');
var nombresComplement = [0];
function ajouterObservation(){
	nombreObservations++;
	nombresComplement.push(0);
	$('#apresDerniereObservation').before('<div id="observation'+nombreObservations+'"></div>');
	$('#observation'+nombreObservations).load('/deposerObservation/'+nombreObservations);
}
function rafraichirListeDEspeces(observation_position){
	var groupe_id = $('#groupes'+observation_position).val();
	$('#especes'+observation_position).load('/ajax/especes/dansGroupe/'+groupe_id);
	rafraichirComplement(observation_position);
}
function ajouterComplement(observation_position){
	nombresComplement[observation_position-1]++;
	var id = 'complement'+observation_position+'-'+nombresComplement[observation_position-1];
	$('#apresDernierComplement'+observation_position).before('<div id="'+id+'"></div>');
	var groupe_id = $('#groupes'+observation_position).val();
	$('#'+id).load('/ajax/chargeinfoscomplementaires/'+observation_position+'/'+groupe_id+'/'+nombresComplement[observation_position-1], function(){
		chargerStadeSexePrecis(observation_position,nombresComplement[observation_position-1]);
	});
}
function rafraichirComplement(observation_position){
	var idMorceau = 'stadeSexe'+observation_position+'-';
	var groupe_id = $('#groupes'+observation_position).val();
	for(var complement_position = 1; complement_position<=nombresComplement[observation_position-1]-1 ; complement_position++){
		var id='#'+idMorceau+complement_position;
		var url = '/ajax/chargeinfoscomplementaires/'+observation_position+'/'+groupe_id+'/'+complement_position+' '+id;
		$(id).load(url);
	}
	var complement_position=nombresComplement[observation_position-1];
	var id='#'+idMorceau+complement_position;
	var url = '/ajax/chargeinfoscomplementaires/'+observation_position+'/'+groupe_id+'/'+complement_position+' '+id;
	$(id).load(url, function(){
		for(var i = 1 ; i<=complement_position; i++){
			chargerStadeSexePrecis(observation_position,i);
		}
	});
}
function chargerStadeSexePrecis(observation_position,complement_position){
	var id = '#stadeSexePrecis'+observation_position+'-'+complement_position;
	var groupe_id = $('#groupes'+observation_position).val();
	var id_select_pere='#stadeSexeSelect'+observation_position+'-'+complement_position;
	var stade_sexe_pere_id = $(id_select_pere).val();
	var url = '/ajax/chargestadesexeprecis/'+groupe_id+'/'+stade_sexe_pere_id+'/'+observation_position+'/'+complement_position;
	$(id).load(url);
}
</script>
}